apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-cm-random
  namespace: {{ .Release.Namespace }}
data:
  file: |
    randomValue1= apple
    randomValue2="Aldebaran"
    randomValue3="451"
    randomValue4="2025"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-cm-nginxconf
  namespace: {{ .Release.Namespace }}
data:
  nginx.conf: |
    user nginx;
    worker_processes  1;
    events {
      worker_connections  10240;
    }
    http {
      server {
          listen       {{ .Values.service.port }};
          server_name  0.0.0.0;
          location / {
              root   /homework;
              index  index.html index.htm;
          }
      }
    }
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-cm-metrics
  namespace: {{ .Release.Namespace }}
data:
  get-metrics.sh: |
    #!/bin/bash
    touch /init/metrics.html
    KUBE_API_SERVER=${KUBERNETES_SERVICE_HOST}:${KUBERNETES_SERVICE_PORT_HTTPS}
    TOKEN=$(cat /var/run/secrets/kubernetes.io/serviceaccount/token)
    curl -k -v -H "Authorization: Bearer $TOKEN" https://$KUBE_API_SERVER/metrics >> /init/metrics.html

